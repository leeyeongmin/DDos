<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="read">
	<select id="setRoom" resultType="read">		<!-- 열람실 room 선택 -->
		select SEAT_NUM,
			   STATUS
		from READINGROOM
		where SEAT_NUM like #{room} || '%'
	</select>
	
	<update id="saveSeat" parameterType="read">		<!-- 좌석 저장(관리자) -->
		update READINGROOM
		set STATUS = '1'
		where  SEAT_NUM in
		<foreach collection="seat" item="item" open="(" close=")" separator=",">
				#{item}
		</foreach>
	</update>
	
	<update id="releaseSeat" parameterType="read">		<!-- 좌석 해제(관리자) -->
		update READINGROOM
		set STATUS = '0'
		where  SEAT_NUM not in
		<foreach collection="seat" item="item" open="(" close=")" separator=",">
				#{item}
		</foreach>
	</update>
	
	<select id="overlap" resultType="read"> 		<!-- 중복 좌석 확인 -->
		select SEAT_NUM,
			   STATUS
		from   READINGROOM
		where SEAT_NUM =  #{selectSeat}
	</select>
	
	<update id="updateSeat" parameterType="read">									<!-- 좌석 사용 변경 -->
		update READINGROOM
		set STATUS = '2'
		where SEAT_NUM = #{selectSeat}
	</update>
	
	<insert id="insertUsing" parameterType="read">							<!-- 좌석 로그 입력 -->
		insert into 
		READINGROOM_HISTORY(READINGROOM_NUM, END_TIME, MEMBER_ID, SEAT_NUM, START_TIME)
					 values(READING_SEQ.NEXTVAL, sysdate+1/24, #{loginId}, #{selectSeat}, sysdate)
	</insert>
	
	<insert id="timecheck" statementType="CALLABLE">		<!-- 프로시저는 insert,update, delete 사용 가능 -->
		{call P_readingroom_timeck()}	
	</insert>
	
	<select id="seat_useing" parameterType="string" resultType="string">
		select SEAT_NUM
		from READINGROOM_HISTORY
		where to_char(end_time,'yyyymmdd') = to_char(sysdate,'yyyymmdd')
		and MEMBER_ID = #{value}
	</select>
	
</mapper>