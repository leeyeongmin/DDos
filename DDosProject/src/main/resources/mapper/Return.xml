<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="rental">
	
	<select id="rentalSearch" resultType="rental" parameterType="rental">
		SELECT B.book_title, R.isbn , R.rental_date , R.due_date , R.member_id 
		FROM  Rental R LEFT OUTER JOIN Book B
    	on (R.isbn = B.isbn)
		<choose>
			<when test="searchTitle != null and searchTitle == 'book_title' ">
				  where ${searchTitle} like '%' || #{searchKeyword} || '%'
				  and r.return_date is null
			</when>
			
			<when test="searchTitle != null and searchTitle == 'isbn' ">
			      where R.${searchTitle} = #{searchKeyword} 
				  and R.return_date is null 
			</when>	
		
			<otherwise>
				where member_id = #{searchKeyword} 
				and R.return_date is null
			</otherwise>	
		</choose>
		
	</select>
	 
</mapper>
