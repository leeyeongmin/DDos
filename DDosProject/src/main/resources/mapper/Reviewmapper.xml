<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review">

	<!-- 리뷰 조회 -->
	<select id="getReviewList" resultType="review"	parameterType="review">
		<!-- SELECT REVIEW_TITLE, MEMBER_ID FROM REVIEW WHERE ISBN = #{isbn} -->
		SELECT * FROM BOOK INNER JOIN REVIEW
		ON
		BOOK.ISBN = REVIEW.ISBN
		WHERE REVIEW.ISBN = #{isbn}
		ORDER BY MAX(REVIWE_POINT) DESC
		<!-- <![CDATA[
		WHERE RN <= #{pageUnit}
		]]> -->
	</select>

	<!-- 리뷰 등록 -->
	<insert id="insertReview" parameterType="review">
		<selectKey keyProperty="reviewNum" resultType="string" order="BEFORE">
			SELECT NVL(MAX(REVIEW_NUM), 0)+1 FROM REVIEW)
		</selectKey>
		INSERT INTO REVIEW(
			ISBN,
			REVIEW_TITLE,
			REVIEW_CONT,
			REVIEW_POINT,
			MEMBER_ID,
			REVIEW_DATE)
		VALUES(
			#{isbn},
			#{reviewTitle},
			#{reviewCont},
			#{reviewPoint},
			#{memberId},
			sysdate)
	</insert>

	<!-- 리뷰 수정 -->
	<update id="updateReview" parameterType="review">
		UPDATE REVIEW SET
		REVIEW_TITLE = #{reviewTitle},
		REVIEW_CONT = #{reviewCont},
		REVIEW_POINT = #{reviewPoint},
		REVIEW_DATE = sysdate
		WHERE REVIEW_NUM = #{review_num} AND ISBN=#{isbn}
	</update>

	<!-- 삭제 -->
	<delete id="deleteReview" parameterType="review">
		DELETE REVIEW
		<where>
			<choose>
				<when test="isbn != null and isbn != ''">
					ISBN = #{isbn}
				</when>
				<otherwise>
					reviewNum = #{review_num}
				</otherwise>
			</choose>
		</where>
	</delete>
</mapper>